<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buổi 6: Lập Trình Socket UDP - Tốc Độ Là Trên Hết</title>
    <link rel="stylesheet" href="https://DTStormBoBo.github.io/css/kawaii.min.css">
</head>
<body>
    <header>
        <h1>Buổi 6: Lập Trình Socket UDP - Tốc Độ Là Trên Hết</h1>
        <p><strong>Tags:</strong> Java, Networking, UDP, DatagramSocket, Performance | <strong>Categories:</strong> Lập Trình Mạng | <strong>Date:</strong> 2025-12-28</p>
        <p>Tìm hiểu giao thức UDP không kết nối, so sánh với TCP và cách truyền tải gói tin nhanh chóng bằng DatagramPacket.</p>
    </header>
    <main>
        <section>
            <h2>1. Mở đầu: UDP - "Gửi rồi quên" (Fire and Forget)</h2>
            <p>Trong bài trước, chúng ta thấy TCP rất cẩn thận (bắt tay 3 bước). Nhưng sự cẩn thận đó sinh ra độ trễ (latency). Trong thế giới Real-time (Livestream, Game Online) hoặc các dịch vụ hạ tầng mạng (DNS, DHCP), chúng ta cần tốc độ hơn là sự hoàn hảo. Đó là lúc <strong>UDP</strong> lên ngôi.</p>
            <h3>So sánh nhanh TCP vs UDP</h3>
            <table>
                <thead>
                    <tr>
                        <th>Đặc điểm</th>
                        <th>TCP (Transmission Control Protocol)</th>
                        <th>UDP (User Datagram Protocol)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Kết nối</strong></td>
                        <td>Có kết nối (Connection-oriented)</td>
                        <td>Không kết nối (Connectionless)</td>
                    </tr>
                    <tr>
                        <td><strong>Độ tin cậy</strong></td>
                        <td>Cao (đảm bảo nhận đủ, đúng thứ tự)</td>
                        <td>Thấp (có thể mất gói, sai thứ tự)</td>
                    </tr>
                    <tr>
                        <td><strong>Tốc độ</strong></td>
                        <td>Chậm hơn (do thủ tục kiểm tra)</td>
                        <td>Rất nhanh</td>
                    </tr>
                    <tr>
                        <td><strong>Dữ liệu</strong></td>
                        <td>Luồng (Stream)</td>
                        <td>Gói tin (Datagram)</td>
                    </tr>
                    <tr>
                        <td><strong>Ví dụ</strong></td>
                        <td>Web (HTTP), Email (SMTP), File (FTP)</td>
                        <td>Video Call, Game, DNS, Logs</td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section>
            <h2>2. Cơ chế hoạt động của Socket UDP</h2>
            <p>Khác với TCP có <code>ServerSocket</code> và <code>Socket</code>, trong UDP Java chỉ dùng 2 lớp chính cho cả Client và Server:</p>
            <ol>
                <li><strong><code>DatagramSocket</code>:</strong> Giống như cái "hòm thư". Dùng để gửi và nhận thư.</li>
                <li><strong><code>DatagramPacket</code>:</strong> Chính là "bức thư" (gói tin). Chứa dữ liệu (<code>byte[]</code>) và địa chỉ người nhận.</li>
            </ol>
            <blockquote>
                <p><strong>Lưu ý:</strong> Trong UDP, không có khái niệm "Client kết nối tới Server". Client chỉ đơn giản là đóng gói dữ liệu và ném về phía IP/Port của Server. Server chỉ việc mở cổng và hứng lấy bất cứ thứ gì bay tới.</p>
            </blockquote>
        </section>
        <section>
            <h2>3. Code Thực Chiến: Ứng dụng Chat UDP Đơn Giản</h2>
            <p>Chúng ta sẽ viết một chương trình: Client gửi tin nhắn, Server nhận và in ra màn hình.</p>
            <h3>3.1. Phía Server (Người hứng tin)</h3>
            <p>Server phải chạy trước để mở cổng chờ tin nhắn.</p>
            <pre><code class="language-java">import java.net.DatagramPacket;
import java.net.DatagramSocket;

public class UdpServer {
    public static void main(String[] args) {
        int port = 9876;
        try {
            // 1. Tạo Socket và lắng nghe tại cổng 9876
            DatagramSocket serverSocket = new DatagramSocket(port);
            System.out.println("UDP Server đang chạy tại cổng " + port + "...");

            // 2. Tạo mảng byte để chứa dữ liệu nhận được (Buffer)
            byte[] receiveData = new byte[1024]; // Tối đa 1024 bytes mỗi gói

            while (true) {
                // 3. Tạo gói tin rỗng để hứng dữ liệu
                DatagramPacket receivePacket = new DatagramPacket(receiveData, receiveData.length);

                // 4. Chờ nhận dữ liệu (Blocking)
                serverSocket.receive(receivePacket);

                // 5. Xử lý dữ liệu nhận được
                String message = new String(receivePacket.getData(), 0, receivePacket.getLength());
                
                // Lấy thông tin người gửi để có thể phản hồi sau này
                String clientIP = receivePacket.getAddress().getHostAddress();
                int clientPort = receivePacket.getPort();

                System.out.println("Nhận từ [" + clientIP + ":" + clientPort + "]: " + message);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}</code></pre>
            <h3>3.2. Phía Client (Người ném tin)</h3>
            <p>Client không cần connect. Chỉ cần gói ghém dữ liệu và gửi đi.</p>
            <pre><code class="language-java">import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.util.Scanner;

public class UdpClient {
    public static void main(String[] args) {
        try {
            // 1. Tạo Socket (Không cần port cụ thể, hệ thống tự cấp)
            DatagramSocket clientSocket = new DatagramSocket();
            InetAddress serverIP = InetAddress.getByName("localhost");
            int serverPort = 9876;
            
            Scanner scanner = new Scanner(System.in);
            System.out.println("Nhập tin nhắn để gửi (gõ 'exit' để thoát):");

            while (true) {
                System.out.print("Client > ");
                String message = scanner.nextLine();
                if ("exit".equalsIgnoreCase(message)) break;

                // 2. Chuyển chuỗi thành mảng byte
                byte[] sendData = message.getBytes();

                // 3. Đóng gói tin (Dữ liệu + IP Đích + Port Đích)
                DatagramPacket sendPacket = new DatagramPacket(sendData, sendData.length, serverIP, serverPort);

                // 4. Bắn gói tin đi
                clientSocket.send(sendPacket);
            }
            clientSocket.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}</code></pre>
        </section>
        <section>
            <h2>4. Những vấn đề kỹ thuật cần lưu ý (Góc nhìn DevOps)</h2>
            <p>Khi làm việc với UDP, bạn sẽ gặp những tình huống "dở khóc dở cười" mà TCP không có:</p>
            <ul>
                <li><strong>Packet Loss (Mất gói):</strong> Nếu Server đang bận xử lý gói 1 mà Client bắn tiếp gói 2, gói 2 có thể bị Server (hoặc Router) vứt bỏ không thương tiếc. Code của bạn phải chấp nhận việc mất dữ liệu.</li>
                <li><strong>Giới hạn kích thước:</strong> Một gói UDP an toàn (safe payload) thường nhỏ hơn 512 bytes (để tránh bị phân mảnh - fragmentation - khi đi qua các router). Đừng cố gửi cả file ảnh qua một gói UDP duy nhất!</li>
                <li><strong>Bảo mật:</strong> UDP rất dễ bị làm giả địa chỉ IP nguồn (IP Spoofing), dẫn đến các cuộc tấn công DDoS (UDP Flood).</li>
            </ul>
        </section>
    </main>
</body>
</html>
